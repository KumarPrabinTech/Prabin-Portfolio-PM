<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Inference Playground - Learn Fine-Tuning vs Inference Controls</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .section-title {
            font-size: 20px;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 14px;
        }

        input[type="text"], input[type="password"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, input[type="password"]:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 14px;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .control-group {
            display: grid;
            grid-template-columns: 1fr 80px;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
        }

        input[type="range"] {
            width: 100%;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .help-text {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .preset-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 15px;
        }

        .preset-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .preset-option:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .preset-option input[type="radio"] {
            width: auto;
        }

        .output-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .output-meta {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
            color: #555;
        }

        .educational-section {
            background: #fff8e1;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin-top: 30px;
        }

        .educational-section h3 {
            color: #f57f17;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .educational-section h4 {
            color: #f57f17;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .educational-section p {
            line-height: 1.6;
            color: #555;
            margin-bottom: 15px;
        }

        .educational-section ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .educational-section li {
            margin-bottom: 8px;
            line-height: 1.6;
            color: #555;
        }

        .loader {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ LLM Inference Playground</h1>
            <p>Learn how inference controls work ‚Äî and why they're NOT fine-tuning</p>
        </div>

        <div class="content">
            <!-- Section 1: API Key Setup -->
            <div class="section">
                <div class="section-title">üîê API Key Setup</div>
                <div class="input-group">
                    <label for="apiKey">Google Gemini API Key</label>
                    <input type="password" id="apiKey" placeholder="Enter your Gemini API key (starts with AIza...)">
                    <div class="help-text">Get your free API key from <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a></div>
                </div>
                <button id="validateBtn">Validate API Key</button>
                <div id="validationStatus"></div>
            </div>

            <!-- Section 2: Model Selection -->
            <div class="section" id="modelSection" style="display: none;">
                <div class="section-title">üß† Model Selection</div>
                <div class="input-group">
                    <label for="modelSelect">Available Models</label>
                    <select id="modelSelect">
                        <option value="">Loading models...</option>
                    </select>
                    <div class="help-text">Different models have different capabilities. Don't worry if one fails ‚Äî we'll try a backup!</div>
                </div>
            </div>

            <!-- Section 3: Response Style Presets -->
            <div class="section" id="presetsSection" style="display: none;">
                <div class="section-title">üé≠ Response Style</div>
                <div class="preset-group">
                    <label class="preset-option">
                        <input type="radio" name="preset" value="innovative" checked>
                        <span>Innovative Thinker</span>
                    </label>
                    <label class="preset-option">
                        <input type="radio" name="preset" value="factual">
                        <span>Factual & Precise</span>
                    </label>
                    <label class="preset-option">
                        <input type="radio" name="preset" value="funny">
                        <span>Funny Kid (8-10)</span>
                    </label>
                    <label class="preset-option">
                        <input type="radio" name="preset" value="pm">
                        <span>Product Manager</span>
                    </label>
                    <label class="preset-option">
                        <input type="radio" name="preset" value="facts">
                        <span>No-Nonsense Facts</span>
                    </label>
                    <label class="preset-option">
                        <input type="radio" name="preset" value="custom">
                        <span>Custom</span>
                    </label>
                </div>
                <div class="help-text">These presets change both the instructions AND the inference parameters. Try them all!</div>
            </div>

            <!-- Section 4: Hyperparameter Controls -->
            <div class="section" id="controlsSection" style="display: none;">
                <div class="section-title">üéõÔ∏è Model Controls (Inference Tuning)</div>
                
                <div class="input-group">
                    <label>Temperature: <span id="tempValue">0.7</span></label>
                    <div class="control-group">
                        <input type="range" id="temperature" min="0" max="1.5" step="0.1" value="0.7">
                        <input type="number" id="temperatureNum" min="0" max="1.5" step="0.1" value="0.7">
                    </div>
                    <div class="help-text">Controls creativity. Low = predictable, High = creative/random</div>
                </div>

                <div class="input-group">
                    <label>Top-P: <span id="topPValue">0.9</span></label>
                    <div class="control-group">
                        <input type="range" id="topP" min="0" max="1" step="0.05" value="0.9">
                        <input type="number" id="topPNum" min="0" max="1" step="0.05" value="0.9">
                    </div>
                    <div class="help-text">Controls diversity. Lower = focuses on most likely words</div>
                </div>

                <div class="input-group">
                    <label>Top-K: <span id="topKValue">40</span></label>
                    <div class="control-group">
                        <input type="range" id="topK" min="1" max="100" step="1" value="40">
                        <input type="number" id="topKNum" min="1" max="100" step="1" value="40">
                    </div>
                    <div class="help-text">Limits word choices. Lower = more focused vocabulary</div>
                </div>

                <div class="input-group">
                    <label>Max Output Tokens: <span id="maxTokensValue">1024</span></label>
                    <div class="control-group">
                        <input type="range" id="maxTokens" min="50" max="2048" step="50" value="1024">
                        <input type="number" id="maxTokensNum" min="50" max="2048" step="50" value="1024">
                    </div>
                    <div class="help-text">Maximum length of response (roughly 4 characters = 1 token)</div>
                </div>
            </div>

            <!-- Section 5: Instruction & Prompt -->
            <div class="section" id="promptSection" style="display: none;">
                <div class="section-title">üß† Instruction & Prompt</div>
                
                <div class="input-group">
                    <label for="systemPrompt">System / Instruction Prompt</label>
                    <textarea id="systemPrompt" rows="4" placeholder="Instructions that guide the model's behavior..."></textarea>
                    <div class="help-text">This tells the model HOW to respond (tone, style, behavior)</div>
                </div>

                <div class="input-group">
                    <label for="userPrompt">User Prompt</label>
                    <textarea id="userPrompt" rows="3" placeholder="What do you want to ask?">Explain quantum computing in simple terms.</textarea>
                    <div class="help-text">This is your actual question or request</div>
                </div>

                <button id="runBtn" disabled>Run Prompt</button>
            </div>

            <!-- Section 6: Output -->
            <div class="section" id="outputSection" style="display: none;">
                <div class="section-title">üì§ Model Output</div>
                <div class="output-box" id="output">Waiting for your first prompt...</div>
                <div class="output-meta" id="outputMeta"></div>
            </div>

            <!-- Section 7: Educational Content -->
            <div class="educational-section">
                <h3>üìò Understanding Fine-Tuning (Simple Explanation)</h3>
                
                <h4>What You're Learning in This Playground:</h4>
                <p>This playground lets you control how an AI model generates text using <strong>inference controls</strong>. Think of it like adjusting the settings on a camera ‚Äî you're not changing the camera itself, just how it takes pictures.</p>

                <h4>üå°Ô∏è What is Temperature?</h4>
                <p><strong>Temperature</strong> controls how "adventurous" the model is with word choices:</p>
                <ul>
                    <li><strong>Low (0.0-0.3):</strong> Very predictable, always picks the most likely words. Like a cautious driver who always follows the same route.</li>
                    <li><strong>Medium (0.5-0.8):</strong> Balanced between creativity and reliability. Good for most tasks.</li>
                    <li><strong>High (1.0+):</strong> Very creative, sometimes random. Like a jazz musician improvising ‚Äî exciting but unpredictable!</li>
                </ul>

                <h4>üéØ What are Top-P and Top-K?</h4>
                <p><strong>Top-P (nucleus sampling)</strong> and <strong>Top-K</strong> control which words the model can choose from:</p>
                <ul>
                    <li><strong>Top-K:</strong> "Only consider the top K most likely words." If K=10, the model only looks at its 10 favorite word choices.</li>
                    <li><strong>Top-P:</strong> "Keep adding likely words until you reach P% probability." If P=0.9 (90%), it includes enough words to cover 90% of likely outcomes.</li>
                </ul>
                <p><strong>Analogy:</strong> Imagine choosing ice cream flavors. Top-K says "pick from these exact 10 flavors." Top-P says "pick from however many flavors add up to 90% of what people usually order."</p>

                <h4>üîß This Playground is NOT Real Fine-Tuning!</h4>
                <p>What you're doing here is <strong>inference tuning</strong> ‚Äî adjusting how the model generates responses <em>during generation</em>. This is like:</p>
                <ul>
                    <li>Adjusting the volume on a speaker (you're not changing the music, just how it plays)</li>
                    <li>Changing camera settings (you're not redesigning the camera)</li>
                </ul>

                <h4>üéì What is REAL Fine-Tuning?</h4>
                <p><strong>Fine-tuning</strong> means training the model on new data to change its internal knowledge and behavior permanently. This is like:</p>
                <ul>
                    <li>Teaching a student a new subject (not just telling them how to answer questions)</li>
                    <li>Training a musician to play a new instrument (not just asking them to play louder)</li>
                </ul>
                <p><strong>Real fine-tuning requires:</strong></p>
                <ul>
                    <li>Training data (examples of inputs and desired outputs)</li>
                    <li>Computational power (GPUs/TPUs running for hours or days)</li>
                    <li>Technical expertise (machine learning knowledge)</li>
                    <li>A new version of the model (the original model is modified)</li>
                </ul>

                <h4>ü§î Three Ways to Control AI Behavior:</h4>
                <p><strong>1. Prompt Engineering</strong> ‚Äî Writing better instructions</p>
                <ul>
                    <li><em>Example:</em> "Act as a pirate and explain photosynthesis"</li>
                    <li><em>Like:</em> Asking someone politely vs. rudely ‚Äî same person, different response</li>
                </ul>

                <p><strong>2. Inference Tuning (This Playground!)</strong> ‚Äî Adjusting generation settings</p>
                <ul>
                    <li><em>Example:</em> Setting temperature to 0.1 for factual answers, 1.2 for creative stories</li>
                    <li><em>Like:</em> Adjusting your microphone volume ‚Äî you sound different but you're still you</li>
                </ul>

                <p><strong>3. Fine-Tuning</strong> ‚Äî Training the model on new data</p>
                <ul>
                    <li><em>Example:</em> Training a model on 10,000 medical papers so it understands medical terminology</li>
                    <li><em>Like:</em> Going to medical school ‚Äî you're fundamentally changed by learning new knowledge</li>
                </ul>

                <h4>üîë API Keys: What They Are and How to Protect Them</h4>
                <p>An <strong>API key</strong> is like a password that lets you use an AI service. It's tied to your account and often to your payment method.</p>
                <ul>
                    <li><strong>Never share your API key</strong> ‚Äî treat it like your bank password!</li>
                    <li><strong>Don't commit it to GitHub</strong> or post it online</li>
                    <li><strong>Rotate it regularly</strong> ‚Äî generate a new one if you think it was exposed</li>
                    <li><strong>Set usage limits</strong> in your AI provider's dashboard to avoid surprise bills</li>
                </ul>

                <p><strong>Why is this playground asking for your key?</strong> Because it runs entirely in your browser! Your key never leaves your computer ‚Äî all API calls are made directly from your browser to Google's servers. This is safer than sending your key to a third-party server, but you should still keep it private.</p>
            </div>
        </div>
    </div>

    <script>
        // State management
        const state = {
            apiKey: '',
            isValidated: false,
            models: [],
            selectedModel: '',
            fallbackModels: ['gemini-1.5-flash', 'gemini-1.5-pro', 'gemini-pro']
        };

        // Preset configurations
        const presets = {
            innovative: {
                temperature: 1.2,
                topP: 0.95,
                topK: 60,
                systemPrompt: "You are an innovative thinker who loves exploring new ideas and making creative connections. You're enthusiastic, imaginative, and always looking for novel perspectives. Think outside the box and suggest unconventional approaches."
            },
            factual: {
                temperature: 0.2,
                topP: 0.8,
                topK: 20,
                systemPrompt: "You are a precise, factual assistant. Provide accurate information with proper citations when possible. Stick to verified facts and avoid speculation. Be concise, clear, and organized in your responses."
            },
            funny: {
                temperature: 1.0,
                topP: 0.9,
                topK: 50,
                systemPrompt: "You are a funny, energetic kid aged 8-10 years old! You love jokes, silly comparisons, and making things fun. Use simple words, get excited about things, and try to make people laugh. Add 'like' and 'totally' sometimes, and use fun examples!"
            },
            pm: {
                temperature: 0.6,
                topP: 0.85,
                topK: 35,
                systemPrompt: "You are an experienced product manager. You think strategically about user needs, business goals, and technical feasibility. Structure your responses with clear frameworks, consider trade-offs, and provide actionable insights. Focus on impact and outcomes."
            },
            facts: {
                temperature: 0.1,
                topP: 0.7,
                topK: 10,
                systemPrompt: "You are a no-nonsense fact teller. Give direct, concise answers without fluff. State facts clearly without unnecessary elaboration. Be brief and to the point. Skip pleasantries and focus on information."
            },
            custom: {
                temperature: 0.7,
                topP: 0.9,
                topK: 40,
                systemPrompt: "You are a helpful assistant."
            }
        };

        // DOM elements
        const elements = {
            apiKey: document.getElementById('apiKey'),
            validateBtn: document.getElementById('validateBtn'),
            validationStatus: document.getElementById('validationStatus'),
            modelSection: document.getElementById('modelSection'),
            modelSelect: document.getElementById('modelSelect'),
            presetsSection: document.getElementById('presetsSection'),
            controlsSection: document.getElementById('controlsSection'),
            promptSection: document.getElementById('promptSection'),
            outputSection: document.getElementById('outputSection'),
            systemPrompt: document.getElementById('systemPrompt'),
            userPrompt: document.getElementById('userPrompt'),
            runBtn: document.getElementById('runBtn'),
            output: document.getElementById('output'),
            outputMeta: document.getElementById('outputMeta')
        };

        // Sync slider with number input
        function syncControls(sliderId, numberId, displayId) {
            const slider = document.getElementById(sliderId);
            const number = document.getElementById(numberId);
            const display = document.getElementById(displayId);

            slider.addEventListener('input', (e) => {
                number.value = e.target.value;
                display.textContent = e.target.value;
            });

            number.addEventListener('input', (e) => {
                slider.value = e.target.value;
                display.textContent = e.target.value;
            });
        }

        // Initialize control syncing
        syncControls('temperature', 'temperatureNum', 'tempValue');
        syncControls('topP', 'topPNum', 'topPValue');
        syncControls('topK', 'topKNum', 'topKValue');
        syncControls('maxTokens', 'maxTokensNum', 'maxTokensValue');

        // Apply preset
        function applyPreset(presetName) {
            const preset = presets[presetName];
            if (!preset) return;

            // Update temperature
            document.getElementById('temperature').value = preset.temperature;
            document.getElementById('temperatureNum').value = preset.temperature;
            document.getElementById('tempValue').textContent = preset.temperature;

            // Update topP
            document.getElementById('topP').value = preset.topP;
            document.getElementById('topPNum').value = preset.topP;
            document.getElementById('topPValue').textContent = preset.topP;

            // Update topK
            document.getElementById('topK').value = preset.topK;
            document.getElementById('topKNum').value = preset.topK;
            document.getElementById('topKValue').textContent = preset.topK;

            // Update system prompt
            elements.systemPrompt.value = preset.systemPrompt;
        }

        // Preset change handler
        document.querySelectorAll('input[name="preset"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                applyPreset(e.target.value);
            });
        });

        // Apply default preset on load
        applyPreset('innovative');

        // Show status message
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `status status-${type}`;
            element.style.display = 'block';
        }

        // Validate API key
        elements.validateBtn.addEventListener('click', async () => {
            const apiKey = elements.apiKey.value.trim();
            
            if (!apiKey) {
                showStatus('validationStatus', '‚ùå Please enter an API key', 'error');
                return;
            }

            elements.validateBtn.disabled = true;
            elements.validateBtn.innerHTML = '<span class="loader"></span> Validating...';

            try {
                // Try to list models
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`
                );

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Invalid API key');
                }

                const data = await response.json();
                state.apiKey = apiKey;
                state.isValidated = true;
                state.models = data.models || [];

                showStatus('validationStatus', '‚úÖ API Key Valid! Loading models...', 'success');
                
                // Populate models
                populateModels();
                
                // Show sections
                elements.modelSection.style.display = 'block';
                elements.presetsSection.style.display = 'block';
                elements.controlsSection.style.display = 'block';
                elements.promptSection.style.display = 'block';
                elements.outputSection.style.display = 'block';
                elements.runBtn.disabled = false;

            } catch (error) {
                showStatus('validationStatus', 
                    `‚ùå Validation failed: ${error.message}. Make sure your API key is correct and you have API access enabled.`, 
                    'error');
                state.isValidated = false;
            } finally {
                elements.validateBtn.disabled = false;
                elements.validateBtn.textContent = 'Validate API Key';
            }
        });

        // Populate models dropdown
        function populateModels() {
            const generativeModels = state.models.filter(model => 
                model.supportedGenerationMethods?.includes('generateContent') &&
                !model.name.includes('embedding')
            );

            if (generativeModels.length === 0) {
                elements.modelSelect.innerHTML = '<option value="">No generative models found</option>';
                showStatus('validationStatus', 
                    '‚ö†Ô∏è API key valid, but no suitable models found. We\'ll use fallback models.', 
                    'info');
                return;
            }

            elements.modelSelect.innerHTML = generativeModels.map(model => {
                const modelId = model.name.replace('models/', '');
                return `<option value="${modelId}">${modelId}</option>`;
            }).join('');

            state.selectedModel = generativeModels[0].name.replace('models/', '');
        }

        // Get current model or fallback
        function getModelToUse() {
            const selected = elements.modelSelect.value;
            if (selected) return selected;
            return state.fallbackModels[0];
        }

        // Run prompt
        elements.runBtn.addEventListener('click', async () => {
            if (!state.isValidated) {
                showStatus('validationStatus', '‚ùå Please validate your API key first', 'error');
                return;
            }

            const userPrompt = elements.userPrompt.value.trim();
            if (!userPrompt) {
                elements.output.textContent = '‚ö†Ô∏è Please enter a user prompt';
                return;
            }

            elements.runBtn.disabled = true;
            elements.runBtn.innerHTML = '<span class="loader"></span> Generating...';
            elements.output.textContent = 'Generating response...';
            elements.outputMeta.innerHTML = '';

            const startTime = Date.now();

            // Get parameters
            const params = {
                temperature: parseFloat(document.getElementById('temperature').value),
                topP: parseFloat(document.getElementById('topP').value),
                topK: parseInt(document.getElementById('topK').value),
                maxOutputTokens: parseInt(document.getElementById('maxTokens').value)
            };

            const systemPrompt = elements.systemPrompt.value.trim();

            // Build contents array
            const contents = [];
            if (systemPrompt) {
                contents.push({
                    role: 'user',
                    parts: [{ text: `[SYSTEM INSTRUCTION]: ${systemPrompt}\n\n[USER REQUEST]: ${userPrompt}` }]
                });
            } else {
                contents.push({
                    role: 'user',
                    parts: [{ text: userPrompt }]
                });
            }

            // Try models with fallback
            const modelsToTry = [getModelToUse(), ...state.fallbackModels];
            let success = false;
            let usedModel = '';
            let responseText = '';
            let attemptLog = [];

            for (const modelName of modelsToTry) {
                try {
                    attemptLog.push(`Trying ${modelName}...`);
                    
                    const response = await fetch(
                        `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${state.apiKey}`,
                        {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: contents,
                                generationConfig: params
                            })
                        }
                    );

                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.error?.message || 'Generation failed');
                    }

                    const data = await response.json();
                    
                    if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                        responseText = data.candidates[0].content.parts[0].text;
                        usedModel = modelName;
                        success = true;
                        break;
                    } else {
                        throw new Error('No text in response');
                    }

                } catch (error) {
                    attemptLog.push(`‚ùå ${modelName} failed: ${error.message}`);
                    continue;
                }
            }

            const endTime = Date.now();
            const latency = ((endTime - startTime) / 1000).toFixed(2);

            if (success) {
                elements.output.textContent = responseText;
                
                let metaInfo = `‚è±Ô∏è Latency: ${latency}s | ü§ñ Model: ${usedModel}`;
                if (usedModel !== getModelToUse()) {
                    metaInfo += ` | ‚ö†Ô∏è Fallback used (original model failed)`;
                }
                elements.outputMeta.textContent = metaInfo;
            } else {
                elements.output.textContent = '‚ùå All models failed to generate a response.\n\nTroubleshooting:\n' + 
                    '‚Ä¢ Check your API key is valid\n' +
                    '‚Ä¢ Ensure you have quota remaining (check Google Cloud Console)\n' +
                    '‚Ä¢ Try a different model from the dropdown\n' +
                    '‚Ä¢ Some models may not be available in your region\n\n' +
                    'Attempts:\n' + attemptLog.join('\n');
                elements.outputMeta.textContent = 'üí° If issues persist, visit Google AI Studio to check your API status';
            }

            elements.runBtn.disabled = false;
            elements.runBtn.textContent = 'Run Prompt';
        });

        // Allow Enter key to validate API key
        elements.apiKey.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                elements.validateBtn.click();
            }
        });
    </script>
</body>
</html>